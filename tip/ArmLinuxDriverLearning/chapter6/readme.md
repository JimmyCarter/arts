# 嵌入式Linux驱动学习六：并发和竞态

临界资源：是指同一个时段内只允许唯一一个访问者操作的资源。比如打印机、IO模块等，但Linux是多任务的，其内核对资源的管理是抢占式的。多个进程同时运行即所谓的并发，而如果多个进程都同时访问同一个资源就会产生竞态。由于驱动模块的特殊性，它不可避免会存在被多个进程同时“打开、读写、关闭”的情况。设想一下，如果某个驱动的逻辑是open的时候分配一块缓存用于read/write，close的时候又释放缓存，就会存在A进程刚打开的设备节点，B进程就关闭，缓存分配了又释放，最终在读写时导致程序崩溃。

所以，本章主要学习Linux驱动模块有哪些手段可以处理并发时的竞态问题。

## 原子操作

原子操作就是保证对数据修改的完整性，也就是说`a = a + 1`这么简单的表达式也难以避免被编译为多个指令周期，也许在任务A中刚读完表达式右值，又被任务B更新了`a`的寄存器，结果一个简单的自加1的操作都可能出现很多诡异的结果。

## 自旋锁

## 信号量与互斥体

## 完成量